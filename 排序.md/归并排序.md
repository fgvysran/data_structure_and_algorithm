# å½’å¹¶æ’åºï¼ˆæ—¶é—´å¤æ‚åº¦:ï¼ˆ N * logN ï¼‰,ç©ºé—´å¤æ‚åº¦ï¼šOï¼ˆNï¼‰ï¼‰

## ğŸŸ¢ å½’å¹¶æ’åºçš„æ ¸å¿ƒæ€æƒ³

ä¸€å¥è¯æ€»ç»“ï¼š  
**â€œåˆ†è€Œæ²»ä¹‹â€** â€”â€” æŠŠæ•°ç»„ä¸€åˆ†ä¸ºäºŒï¼Œé€’å½’æ’åºå·¦å³ä¸¤è¾¹ï¼Œå†æŠŠä¸¤ä¸ªæœ‰åºçš„éƒ¨åˆ†åˆå¹¶æˆä¸€ä¸ªæœ‰åºçš„æ•´ä½“ã€‚

---

## ğŸŸ¡ æ­¥éª¤æ‹†è§£

1. **åˆ†**ï¼šæŠŠæ•°ç»„ä»ä¸­é—´åŠˆå¼€ï¼Œå˜æˆå·¦å³ä¸¤åŠã€‚

2. **æ²»**ï¼šé€’å½’åœ°å¯¹å·¦å³ä¸¤åŠåˆ†åˆ«æ’åºã€‚

3. **åˆ**ï¼šæŠŠæ’å¥½åºçš„ä¸¤åŠâ€œåˆå¹¶â€æˆä¸€ä¸ªæœ‰åºæ•°ç»„ã€‚

## ä»£ç ï¼š

```java
public void merge_sort(int[]arr,int l,int r){//(l-r)
    if(l >= r)return;
    int mid = l + ((r - l) >> 1);
    merge_sort(arr,l,mid);
    merge_sort(arr,mid + 1,r);
    merge(arr,l,r,mid);
}
public void merge(int[]arr,int l,int r,int mid){
    int[]temp = new int[r - l + 1];
    int x = l,y = mid + 1,c = 0;
    while(x <= mid && y <= r){
        temp[c++] = arr[x] <= arr[y]?arr[x++]:arr[y++];
    }
    while(x <= mid){
        temp[c++] = arr[x++];
    }
    while(y <= r){
        temp[c++] = arr[y++];
    }
    for(int i = 0;i < c;i++){
        arr[l + i] = temp[i];
    }
}
```

### ä¹ é¢˜

###### 5.1.1ï¼ˆå°å’Œé—®é¢˜ï¼‰

åœ¨ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œæ¯ä¸€ä¸ªæ•°å·¦è¾¹æ¯”å½“å‰æ•°å°çš„æ•°ç´¯åŠ èµ·æ¥ï¼Œå«åšè¿™ä¸ªæ•°ç»„çš„å°å’Œã€‚æ±‚ä¸€ä¸ªç»™å®šæ•°ç»„çš„å°å’Œã€‚

ä¾‹å­ï¼šæ•°ç»„ä¸ºï¼š[1,3,4,2,5]

1å·¦è¾¹æ¯”1å°çš„æ•°ï¼šæ²¡æœ‰

3å·¦è¾¹æ¯”3å°çš„æ•°ï¼š1

4å·¦è¾¹æ¯”4å°çš„æ•°ï¼š1,3

2å·¦è¾¹æ¯”2å°çš„æ•°ï¼š1

5å·¦è¾¹æ¯”5å°çš„æ•°ï¼š1,3,4,2

æ‰€ä»¥å°å’Œä¸º1+(1+3)+1+(1+3+4+2)=16

```java
public int merge_sort(int[]arr,int l,int r){//(l-r)
    if(l >= r)return 0;
    int mid = l + ((r - l) >> 1);
    int res = 0;
    res += merge_sort(arr,l,mid);
    res += merge_sort(arr,mid + 1,r);
    res += merge(arr,l,r,mid);
    return res;
}
public int merge(int[]arr,int l,int r,int mid){
    int[]temp = new int[r - l + 1];
    int res = 0,x = l,y = mid + 1,c = 0;
    while(x <= mid && y <= r){
        if(arr[x] == arr[y])temp[c++] = arr[x++];
        else if(arr[x] < arr[y]){
            temp[c++] = arr[x];
            res += arr[x ++] * (r - y + 1);
        }else{
            temp[c++] = arr[y++];
        }
    }
    while(x <= mid){
        temp[c++] = arr[x++];
    }
    while(y <= r){
        temp[c++] = arr[y++];
    }
    for(int i = 0;i < c;i++){
        arr[l + i] = temp[i];
    }
    return res;
}
```

###### 5.1.2ï¼ˆé€†åºå¯¹é—®é¢˜ï¼‰ï¼ˆ[LCR 170. äº¤æ˜“é€†åºå¯¹çš„æ€»æ•° - åŠ›æ‰£ï¼ˆLeetCodeï¼‰](https://leetcode.cn/problems/shu-zu-zhong-de-ni-xu-dui-lcof/description/)ï¼‰

ä»£ç :

```java
class Solution {
    public int reversePairs(int[] record) {
        int n = record.length - 1;
        return merge_sort(record,0,n);
    }
    public int merge_sort(int[]arr,int l,int r){//(l-r)
        if(l >= r)return 0;
        int mid = l + ((r - l) >> 1);
        return merge_sort(arr,l,mid) + merge_sort(arr,mid + 1,r) + merge(arr,l,r,mid);
    }
public int merge(int[]arr,int l,int r,int mid){
    int[]temp = new int[r - l + 1];
    int res = 0;
    int x = l,y = mid + 1,c = 0;
    while(x <= mid && y <= r){
        if(arr[x] <= arr[y]){
            temp[c++] = arr[x++];
        }else{
            res += mid - x + 1;
            temp[c++] = arr[y++];
        }

    }
    while(x <= mid){
        temp[c++] = arr[x++];
    }
    while(y <= r){
        temp[c++] = arr[y++];
    }
    for(int i = 0;i < c;i++){
        arr[l + i] = temp[i];
    }//if (c >= 0) System.arraycopy(temp, 0, arr, l, c);
    return res;
}
}
```
